require 'json'

def delete_key(hash, key)
  hash.reject!{|k,v| k == key}
  hash
end

def move_key(hash, from_key, to_key)
  hash[to_key] = hash[from_key]
  hash = delete_key(hash, from_key)
  hash
end

## Using the same etf ticker / asset mappings - therefore these should be largely the same.

# etf      = JSON.parse %q[ {"id":"037a6cb8-215a-4336-a87e-4e17e014c6c7","ticker":"SCHF","description":"Schwab International Equity","security_id":"9c89c70c-7cae-42de-a712-dae94696c419","created_at":"2014-03-23T11:47:18.188-06:00","updated_at":"2014-03-23T11:47:18.188-06:00"} ];
# security = JSON.parse %q[ {"id":"0c46ca25-1283-4781-93ac-708a0c950498","ticker":"CIU","asset_class":"U.S. Intermediate-term Corporate Bonds","asset_type":"bond","mean_return":"-0.000277438846343146","std_dev":"0.00776876479204261","implied_return":"-0.000172160297094722773285780978194668988850739485404657657018800674004497573938501614449452733523905203551178","returns":["-0.000145596892531","0.013165392863982","-0.002581117173079","-0.003279595377568","0.00308377011419","0.001284687736464","0.000093235832118","0.002574547480674","-0.011166732734738","-0.004493788657415","0.00328860086905","0.001778750828777","0.00961773018139","0.004305305732749","0.004967112493151","-0.000512213599694","-0.000364807726559","-0.002018213010027","-0.002506681679594","-0.005338552447354","0.011887281344979","-0.01343081767872","-0.003302307051254","0.002292222130885","0.000911449953633","-0.003180576459339","0.004558902543754","-0.00961045648564","-0.007229955280791","0.003764936895796","0.005025928615834","-0.004613632452863","-0.003014622882788","-0.010790464284297","0.000755324550649","-0.014808171956598","0.001431644458791","0.001275152719319","-0.005766110448015","-0.001332575943211","-0.005012704947853","0.001586431147008","0.004382722774228","0.000022731759152","0.002341637235966","-0.003296848080907","0.002039638346815","-0.000674333565136","-0.01068151293686","-0.03915813170614","-0.025959380509276","-0.007302096075666","-0.0626696191864","0.035786025973915","-0.000923362866508","0.001438735600714","0.029719470735886","0.003658655993549","-0.011327006958659","0.002546323371446","0.010378269118498","0.017990341484902","0.029626661641595","0.011643267013795","-0.007731301375322","0.006759395462138","0.006605196883319","-0.010103258014647","0.000201342188659","-0.012159948338219","0.001821416278616","-0.007432725418004","-0.01337487205142","-0.019715349332082","-0.001181125246922","-0.004386416582018","0.00685913880678","-0.002970250765697","-0.001482069204056","0.013994124998196","0.008205313995173","-0.002354585854347","0.004742881717421","0.011254040959359","0.000235109083975","0.008126056103803","-0.003578704283613","0.0106720644015","-0.007380796750405","0.01284233548171","-0.013083742765234","0.009725879200507","-0.001947602353311","0.006587885008376","0.011827241152554","-0.005801141505357","0.007942807190911","-0.00214963700428","0.007298029752484","0.00000409359833","0.006744997163301","-0.002228790006052","0.005739075029253","-0.001567824780931","-0.01384715156518","0.001643053778523","0.004589380037226","0.004162914985077","-0.002536821194027","0.002791208324667","0.002779064526814","0.003440842819802","-0.011161631368418","0.002774448442548","0.004209323480737","-0.009163908121581","-0.005065026737979","0.007467340337101","0.003252880930356","0.00218078659461","0.000351067597772","-0.007173509894459","-0.003550537526157","-0.000753960112846","0.006208753026792","-0.001330171188225","0.000303036371312","0.000589886626676","-0.003629764141685","-0.00294666148815","-0.000350066666986","0.006199181154509","-0.002457189335915","0.005636286700099","-0.013595759149738","0.007020716986867","0.001697096903361","-0.005677152185182","0.000839643288823","-0.005172037035177","0.003740233807997","0.007419789024266","-0.002200141373117","0.002519416396098","0.008029479407013","0.001072260017169","0.007288672058907","-0.001502759322364","0.004205950320181","0.001948715957111","-0.002054061356046","-0.00363734451562","-0.000004419147841","0.004947869212605","0.002969381237726","-0.003477114691411","0.007196397583997","-0.004476698826087","0.001336602064028","0.000870895011553","-0.000329768980596","-0.008161421822529","-0.005989685983534","-0.001351707180081","-0.008465943969252","-0.013229799176114","0.002144338126114","-0.002216233141798","0.000599596306318","0.00167339384347","0.002711634682026","0.000621956938065","0.001281520974935","-0.013284577056556","-0.000086078676848","0.004680870447609","0.003892813727381","-0.003491361884689","0.003694705594713","0.002449959668007","-0.00657772909884","-0.004987261282816","-0.002443456157763","0.006488354150905","0.001434993983327","0.005573489873742","0.00061263670448","0.000236922358869","-0.002004303678304","0.002666916070552","-0.001944575291891","0.00029269421402","0.001598367189505","0.000384449089612","-0.008809954842499","0.006413324695751","0.003385307908963","-0.002478837277915","0.004123892376746","0.000360397698007","-0.001861938959294","0.004903828651839","-0.00453084102311","0.003328466540738","0.00137778943493","-0.005812896437833","-0.006122716728275","-0.003361186376492","-0.00780292942959","0.003444125940571","0.00595856286376","0.001257497960354","0.003949467280993","-0.005047259233714","-0.007296643726666","-0.007808250142948","-0.000526680493273","0.001168539086754","0.00266858764714","0.00050208646709","0.002651981262257","-0.001631251987155","0.001728371761188","-0.001257404866349","0.007691006434182","0.002758653163353","-0.000846073501479","0.002286061950054","0.002001313894196","-0.00121190971866","-0.003411285665962","-0.005623401094275","0.002503306845227","0.001704979441649","-0.005876384615561","0.005354789194218","0.000732009600942","0.000271941562615","-0.000150476930543","-0.000059459791552","-0.006273418254966","-0.001157417617384","0.001294840677491","-0.00430573743068","0.004617959991027","-0.000818607147179","0.003312917045231","-0.000708789276133","0.004779676675424","0.005936693242006","-0.001156995773207","-0.001466896386791","-0.000652579899742","-0.002374728897851","0.003706003575835","0.005046067365548","-0.002350748174672","-0.00244559256509","0.00387550028011","0.002958945165783","-0.001774604025814","0.003251716438407","0.000464051531629","-0.002574147010077","-0.00025101181905","-0.004007984823426","-0.000249725970536","-0.002133709473178","0.003074536290739","-0.002420042233617","-0.00287079094393","-0.002066718840296","0.001438891201819","-0.004820350610041","0.002372311036382","0.000566370342464","-0.002936411428729","-0.006152858122142","0.000784037413463","-0.001476611380166","0.001234769114359","0.001050384487889","-0.005076581770613","0.002592537305313","-0.000032808257266","0.001137698305763","0.000972824311956","0.00034160996287","-0.000036123192423","0.001432788945627","-0.00347283891086","-0.003838614034645","-0.00124044598692","-0.002859820494378","-0.007641567821388","-0.007153287534355","0.000571248158884","-0.023909491444853","0.007683426428168","-0.009363753219181","0.008327879492186","0.006953012123523","-0.001486622705528","-0.002685222348874","-0.000124422716014","-0.009122172950823","-0.001797716656398","0.001675959868695","-0.009144844649595","0.002135027821411","0.010162858563098","0.00371162740043","-0.003288988858671","0.001527788787843","0.004484556412332","0.002892519686178"],"created_at":"2014-03-23T11:47:17.854-06:00","updated_at":"2014-03-23T11:47:17.854-06:00"} ];


########
# USER #
########

user = JSON.parse %q[ {"id":"0d02dac4-4150-4841-86eb-27cfee398906","email":"bonesilverback@gmail.com","referring_url":"https://app.retirementplan.io/proxy.html","landing_url":"https://app.retirementplan.io/api/v1/simulation_count","name":"Franklin George","admin":false,"from_oauth":false,"data":{"last_contact":"1397687578","allowable_drift":"5","simulations_ran":"103","has_selected_expenses":"true","max_contact_frequency":"604800","min_rebalance_spacing":"7776000"},"created_at":"2014-04-16T16:32:58.868-06:00","updated_at":"2014-04-16T17:06:25.394-06:00","accepted_terms":"2014-04-16T16:33:12.962-06:00"} ];

user = delete_key(user, "landing_url")
user = delete_key(user, "referring_url")
user = move_key(user, "data", "hstore_data")

u = User.new(user)
u.valid? # --> true


##################
# AUTHENTICATION #
##################

authentication = JSON.parse %q[ {"id":"11a3b6fe-a855-41c6-8ab1-4439dc7e34d8","uid":"101033749549979024342","provider":"google","username":null,"oauth_token":"ya29.GwCuonaLnXRceSAAAACLSsvKicyXVz23uh8JQzyxcscWAXi64h0b6g0Bi4OvLA","oauth_secret":null,"oauth_expires":"2014-05-19T14:48:11.000-06:00","user_id":"b245c2cb-1a74-4d33-bd22-8f587dcbb6c5","created_at":"2014-05-14T05:32:02.685-06:00","updated_at":"2014-05-19T13:48:14.131-06:00"} ];

authentication = delete_key(authentication, "username")
authentication = delete_key(authentication, "oauth_secret")

a = Authentication.new(authentication)
a.valid? # --> true

#################
# QUESTIONNAIRE #
#################

questionnaire = JSON.parse %q[ {"id":"0294d6e6-5896-4a44-98a9-a5063f402f57","pratt_arrow_low":1.74766908178789,"pratt_arrow_high":2.61713444997737,"age":34,"sex":1,"no_people":6,"real_estate_val":4,"saving_reason":0,"investment_timeline":0,"investment_timeline_length":1,"economy_performance":0,"financial_risk":0,"credit_card":0,"pension":6,"inheritance":4,"bequeath":0,"degree":3,"loan":0,"forseeable_expenses":0,"married":1,"emergency_fund":2,"job_title":0,"user_id":"ce50eb2f-9b81-4f9d-a2c9-cc8d8a5e88f5","created_at":"2014-05-07T16:44:41.030-06:00","updated_at":"2014-05-07T16:44:41.030-06:00","investment_experience":3} ];

q = Questionnaire.new(questionnaire)
q.valid? # --> true


###########
# EXPENSE #
###########

expense = JSON.parse %q[ {"id":"0107204a-1508-44a4-b7c5-f4014e76cce4","description":"Gifts","amount":"500.0","frequency":"annual","ends":null,"onetime_on":null,"notes":"","is_added":false,"user_id":"40656516-246d-40e6-8ff8-3c3938ea86ab","created_at":"2014-04-19T23:58:24.981-06:00","updated_at":"2014-04-19T23:58:24.981-06:00"} ];

e = Expense.new(expense)
e.valid? # --> true


####################
# SIMULATION INPUT #
####################

simulation_input = JSON.parse %q[ {"id":"037b0ecb-36ae-4811-9308-aaac302dce35","user_is_male":true,"married":false,"male_age":21,"female_age":null,"user_retired":false,"retirement_age_male":63,"retirement_age_female":null,"assets":"1000.0","expenses_inflation_index":"100.0","life_insurance":"0.0","income":"50000.0","current_tax_rate":"35.0","salary_increase":"3.0","retirement_income":"10000.0","retirement_expenses":"60.0","retirement_tax_rate":"35.0","income_inflation_index":"30.0","include_home":false,"home_value":null,"sell_house_in":null,"new_home_relative_value":null,"expenses_multiplier":null,"fraction_for_single_income":null,"user_id":"d608c05e-9522-46ec-8888-6bb9815d65aa","created_at":"2014-05-23T11:26:40.224-06:00","updated_at":"2014-05-23T11:32:52.634-06:00"} ];

ss = SimulationInput.new(simulation_input)
ss.valid? # --> true


#############
# PORTFOLIO #
#############

portfolio = JSON.parse %q[ {"id":"057d339c-8e8e-4408-8dbe-717ab619f5b4","user_id":"6ca6ac2d-a146-449d-ace7-89a022a12bcc","expected_return":"0.001299667188742388","expected_std_dev":"0.03622860366070909","weights":{"EWC":0.5844064333956356,"GSG":0.14560837088617168,"XLB":0.26998519571819274},"prettified_weights":{"Canadian Equities":"58.4%","Commodities":"14.6%","Canadian Long-term Bonds":"27.0%"},"data":null,"created_at":"2014-05-11T20:14:39.413-06:00","updated_at":"2014-05-11T20:14:39.413-06:00"} ];

portfolio = delete_key(portfolio, "expected_return")
portfolio = delete_key(portfolio, "expected_std_dev")
portfolio = delete_key(portfolio, "prettified_weights")
portfolio = move_key(portfolio, "data", "hstore_data")

p = Portfolio.new(portfolio)
p.valid? # --> NOT SURE - needs connection to rp-finance.dev
